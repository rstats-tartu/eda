<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="Taavi Päll" />


<title>Exploratory data analysis – Estonian cancer data</title>

<script src="site_libs/jquery/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap/css/readable.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap/shim/respond.min.js"></script>
<script src="site_libs/navigation/tabsets.js"></script>
<link href="site_libs/highlightjs/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 66px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 71px;
  margin-top: -71px;
}

.section h2 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h3 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h4 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h5 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h6 {
  padding-top: 71px;
  margin-top: -71px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->






<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">EDA</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Exploratory data analysis – Estonian cancer data</h1>
<h4 class="author"><em>Taavi Päll</em></h4>
<h4 class="date"><em><ol start="26" style="list-style-type: decimal">
<li>Sept. 2017</li>
</ol></em></h4>

</div>


<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>Cancer and specially lung cancer is becoming one of the leading causes of mortality. In year 2012. cancer claimed 8.2 million lives worldwide, European Union had 15% share (1.27 million). Most cancer deaths are caused by lung-, liver-, stomach-, colorectal-, and breast cancer. Most frequent cancer types are different in females and males. Predictions show that cancer incidence increases from 14 million in 2012. to 22 million in 2030-ties.</p>
<p>Vähkkasvajad on maailmas üks juhtivatest surma põhjustatavatest haigustest, nõudes 8.2 miljonit elu 2012. aastal, sealhulgas on EU-27 osakaal 2012. aastal 1.27 miljonit ehk 15%. Kopsu-, maksa-, mao-, kolorektaal- ja rinnakasvajad põhjustavad enim vähisurmasid. Sagedasemad vähitüübid on naistel ja meestel erinevad. Ennustatakse et haigestumus suureneb maailmas 14 miljonilt 2012. aastal 22 miljonini 2030-ndatel.</p>
<p><br></p>
</div>
<div id="eda" class="section level1">
<h1>EDA</h1>
<p>Exploratory data analysis is iterative process <span class="citation">(Wickham and Grolemund 2017)</span> where you:</p>
<ol style="list-style-type: decimal">
<li><p>Generate questions about your data.</p></li>
<li><p>Search for answers by visualising, transforming, and modelling your data.</p></li>
<li><p>Use what you learn to refine your questions and/or generate new questions.</p></li>
</ol>
<p>Andmeanalüüs on iteratiivne protsess, kus:</p>
<ol style="list-style-type: decimal">
<li><p>Esitatakse esialgsed küsimused millele soovitakse antud andmete põhjal vastuseid;</p></li>
<li><p>Proovitakse neile küsimustele vastuseid leida, kasutades andmete visualiseerimit, transformeerimist ja modelleerimist;</p></li>
<li><p>Andmete põhjal saadud uute teadmiste najal täpsustatakse esitatavaid küsimusi ja tekivad uued küsimused <span class="citation">(Wickham and Grolemund 2017)</span>.</p></li>
</ol>
<div id="questions" class="section level2">
<h2>Questions</h2>
<p>By using cancer incidence data from Estonian Cancer Registry we want to understand:</p>
<ol style="list-style-type: decimal">
<li><p>What is the cancer incidence trend in Estonia?</p></li>
<li><p>What are the most frequent cancer sites?</p></li>
<li><p>What is the most frequent cancer type in men and in women?</p></li>
</ol>
<p><br></p>
<blockquote>
<p>When doing data analysis 80% of time will be spent on data wrangling where you also become familiar with your dataset. So it’s time well spent.</p>
</blockquote>
<p>You must be aware that when looking at your data and searcing for something interesting is multiple hypothesis testing and you need to adjust your expectations.</p>
</div>
<div id="cancer-data-from-estonian-cancer-registry" class="section level2">
<h2>Cancer data from Estonian cancer registry</h2>
<p>Estonian cancer registry data is available via <a href="http://pxweb.tai.ee/PXWeb2015/pxweb/en/02Haigestumus/02Haigestumus__04Pahaloomulised%20kasvajad/?tablelist=true&amp;rxid=279523e2-1ea1-4a02-920b-f85bb19a908d">Health statistics and health research database</a>. We are using cancer incidence dataset from table “PK10: New cases of malignant neoplasms by specified site, sex and age group”.</p>
<p>Detailed information about variables in this dataset can be found from <a href="http://pxweb.tai.ee/PXWeb2015/Resources/PX/Databases/02Haigestumus/04Pahaloomulised%20kasvajad/PKinfo_en.htm">here</a>.</p>
<p><br></p>
<div class="figure">
<img src="img/pk10-page.png" alt="Screen caption from dataset download page. Note that data was downloaded in JSON format." width="600" />
<p class="caption">
Screen caption from dataset download page. Note that data was downloaded in JSON format.
</p>
</div>
<p><br></p>
<p>For your convenience, we have downloaded this dataset into <a href="https://github.com/rstats-tartu/datasets">“rstats-tartu/datasets”</a> GitHub repo.</p>
<p><br></p>
</div>
<div id="create-rstudio-project" class="section level2">
<h2>Create RStudio project</h2>
<p>Create RStudio project from GitHub repo. <em>First</em>, create GitHub repo and call it <code>eda_demo</code>. <em>Second</em>, clone this repo into RStudio project. Detailed instructions can be found <a href="https://rstats-tartu.github.io/createrstudioprojectfromgithub/">here</a>.</p>
<p><br></p>
</div>
<div id="download-cancer-incidence-dataset-from-github" class="section level2">
<h2>Download cancer incidence dataset from GitHub</h2>
<p>Download “cancer_incidence_PK10.json” file from “rstats-tartu/datasets” GitHub repo:</p>
<pre class="r"><code>url &lt;- &quot;https://raw.githubusercontent.com/rstats-tartu/datasets/master/cancer_newcases_PK10.json&quot;
dir.create(&quot;data&quot;)</code></pre>
<pre><code>## Warning in dir.create(&quot;data&quot;): &#39;data&#39; already exists</code></pre>
<pre class="r"><code>download.file(url, &quot;data/cancer_newcases_PK10.json&quot;)</code></pre>
<p><br></p>
</div>
<div id="import-and-prepare-data" class="section level2">
<h2>Import and prepare data</h2>
<p>First we load “tidyverse” library. We are going to need also “stringi” and “stringr” libraries for string manipulation (you guess correctly, stringr is based on stringi). “broom” package converts S3 model object into dataframes for tidy handling.</p>
<pre class="r"><code>library(tidyverse)
library(stringi)
library(stringr)</code></pre>
<p>Then we import dataset using <code>json_to_df()</code> function from “boulder” library.</p>
<p>You can <strong>install “boulder” from GitHub</strong> “<a href="https://github.com/tpall/boulder">tpall/boulder</a>”: “boulder” package has few helper functions and was created to work specificly with Estonian Health Statistics and Health Research Database. However, “boulder” package is still under development and you should use it carefully.</p>
<p>Install “boulder” package if not installed, you need also “devtools” library to install package from GitHub:</p>
<pre class="r"><code># install.packages(&quot;devtools&quot;)
if(!&quot;boulder&quot; %in% installed.packages()){
devtools::install_github(&quot;tpall/boulder&quot;)
  }</code></pre>
</div>
<div id="import-dataset" class="section level2">
<h2>Import dataset</h2>
<pre class="r"><code>library(boulder)
incidence &lt;- json_to_df(&quot;data/cancer_newcases_PK10.json&quot;)</code></pre>
<pre><code>## Data source is Estonian Cancer Registry.</code></pre>
<pre class="r"><code>incidence</code></pre>
<pre><code>## # A tibble: 2,190 x 24
##      Year
##    &lt;fctr&gt;
##  1   2000
##  2   2000
##  3   2000
##  4   2000
##  5   2000
##  6   2000
##  7   2000
##  8   2000
##  9   2000
## 10   2000
## # ... with 2,180 more rows, and 23 more variables: `Specified
## #   site` &lt;fctr&gt;, Sex &lt;fctr&gt;, `0-4` &lt;int&gt;, `5-9` &lt;int&gt;, `10-14` &lt;int&gt;,
## #   `15-19` &lt;int&gt;, `20-24` &lt;int&gt;, `25-29` &lt;int&gt;, `30-34` &lt;int&gt;,
## #   `35-39` &lt;int&gt;, `40-44` &lt;int&gt;, `45-49` &lt;int&gt;, `50-54` &lt;int&gt;,
## #   `55-59` &lt;int&gt;, `60-64` &lt;int&gt;, `65-69` &lt;int&gt;, `70-74` &lt;int&gt;,
## #   `75-79` &lt;int&gt;, `80-84` &lt;int&gt;, `85 and older` &lt;int&gt;, label &lt;chr&gt;,
## #   source &lt;chr&gt;, updated &lt;chr&gt;</code></pre>
<p>We have columns “Year”, “Specified site”, “Sex”, age groups from “0-4” to “85 and older”, “label”, “source”, “update”.</p>
<p>“Specified site” indicates the anatomical site of the cancer followed by ICD-10 code in parentheses (there is ICD-10 code for “Burned when water skis caught on fire: Y91.07XA” or “V97.33XD Sucked into jet engine, subsequent encounter”).</p>
<p>For better overview let’s filter out “Specified site” values that are longer than 30 characters.</p>
<pre class="r"><code>filter(incidence, str_length(`Specified site`) &lt; 30)</code></pre>
<pre><code>## # A tibble: 1,110 x 24
##      Year           `Specified site`    Sex `0-4` `5-9` `10-14` `15-19`
##    &lt;fctr&gt;                     &lt;fctr&gt; &lt;fctr&gt; &lt;int&gt; &lt;int&gt;   &lt;int&gt;   &lt;int&gt;
##  1   2000                ..Lip (C00)    Men     0     0       0       0
##  2   2000                ..Lip (C00)  Women     0     0       0       0
##  3   2000          ..Tongue (C01-02)    Men     0     0       0       0
##  4   2000          ..Tongue (C01-02)  Women     0     0       0       0
##  5   2000        ..Nasopharynx (C11)    Men     0     0       0       0
##  6   2000        ..Nasopharynx (C11)  Women     1     0       0       0
##  7   2000 Digestive organs (C15-C26)    Men     1     0       0       0
##  8   2000 Digestive organs (C15-C26)  Women     0     0       0       0
##  9   2000         ..Oesophagus (C15)    Men     0     0       0       0
## 10   2000         ..Oesophagus (C15)  Women     0     0       0       0
## # ... with 1,100 more rows, and 17 more variables: `20-24` &lt;int&gt;,
## #   `25-29` &lt;int&gt;, `30-34` &lt;int&gt;, `35-39` &lt;int&gt;, `40-44` &lt;int&gt;,
## #   `45-49` &lt;int&gt;, `50-54` &lt;int&gt;, `55-59` &lt;int&gt;, `60-64` &lt;int&gt;,
## #   `65-69` &lt;int&gt;, `70-74` &lt;int&gt;, `75-79` &lt;int&gt;, `80-84` &lt;int&gt;, `85 and
## #   older` &lt;int&gt;, label &lt;chr&gt;, source &lt;chr&gt;, updated &lt;chr&gt;</code></pre>
<p><strong>Year, <code>Specified site</code> and Sex are factors.</strong> We convert Year to numeric and “Specified site” and Sex to character using <code>parse_</code> functions from “readr” package.</p>
<pre class="r"><code>## Year to numeric
incidence &lt;- incidence %&gt;% mutate_at(&quot;Year&quot;, parse_number)
## Site and Sex to character
incidence &lt;- incidence %&gt;% mutate_at(c(&quot;Specified site&quot;, &quot;Sex&quot;), parse_character)
incidence</code></pre>
<pre><code>## # A tibble: 2,190 x 24
##     Year                                                  `Specified site`
##    &lt;dbl&gt;                                                             &lt;chr&gt;
##  1  2000                                 All malignant neoplasms (C00-C97)
##  2  2000                                 All malignant neoplasms (C00-C97)
##  3  2000 All malignant neoplasms except skin (other) (C00-C97, except C44)
##  4  2000 All malignant neoplasms except skin (other) (C00-C97, except C44)
##  5  2000                            Lip, oral cavity and pharynx (C00-C14)
##  6  2000                            Lip, oral cavity and pharynx (C00-C14)
##  7  2000                                                       ..Lip (C00)
##  8  2000                                                       ..Lip (C00)
##  9  2000                                                 ..Tongue (C01-02)
## 10  2000                                                 ..Tongue (C01-02)
## # ... with 2,180 more rows, and 22 more variables: Sex &lt;chr&gt;, `0-4` &lt;int&gt;,
## #   `5-9` &lt;int&gt;, `10-14` &lt;int&gt;, `15-19` &lt;int&gt;, `20-24` &lt;int&gt;,
## #   `25-29` &lt;int&gt;, `30-34` &lt;int&gt;, `35-39` &lt;int&gt;, `40-44` &lt;int&gt;,
## #   `45-49` &lt;int&gt;, `50-54` &lt;int&gt;, `55-59` &lt;int&gt;, `60-64` &lt;int&gt;,
## #   `65-69` &lt;int&gt;, `70-74` &lt;int&gt;, `75-79` &lt;int&gt;, `80-84` &lt;int&gt;, `85 and
## #   older` &lt;int&gt;, label &lt;chr&gt;, source &lt;chr&gt;, updated &lt;chr&gt;</code></pre>
<p><br></p>
<blockquote>
<p>We can see that number of new cancer cases is available from years 2000 to 2014 for both sexes, 18 age groups and 1 different types of cancer sites …</p>
</blockquote>
<p><strong>Hold on…</strong> This table has data intermingled with summary data – cases of specific cancer types are next to total cases – , that’s bad!</p>
<pre class="r"><code>Year  Site                              Sex
&lt;fctr&gt;&lt;fctr&gt;                            &lt;fctr&gt;
2000    All malignant neoplasms (C00-C97)   Men     &lt;- tallies
2000    All malignant neoplasms (C00-C97)   Women     &lt;- tallies
2000    All malignant neoplasms except skin (other) (C00-C97, except C44)   Men &lt;- tallies
2000    All malignant neoplasms except skin (other) (C00-C97, except C44)   Women   &lt;- tallies
2000    Lip, oral cavity and pharynx (C00-C14)  Men &lt;- tallies
2000    Lip, oral cavity and pharynx (C00-C14)  Women   &lt;- tallies
2000    ..Lip (C00) Men 
2000    ..Lip (C00) Women   
2000    ..Tongue (C01-02)   Men 
2000    ..Tongue (C01-02)</code></pre>
<p>Summaries are provided for different range of <strong>ICD10</strong> codes e.g. “(C00-C97)” covers all types of cancer.</p>
<p>Here we are not going to do fix this, but we must keep this in mind when summarising data.</p>
<p>Additionally, <strong>we have three metadata columns</strong> in dataset called “label”, “source” and “updated”.</p>
<ul>
<li>Variable “label” says what the values are,</li>
<li>“source” gives us info about data origin and</li>
<li>“updated” is the date of the last update.</li>
</ul>
<p>Because these three seem to be constants in our table, we want to place them into separate objects for later use in plot annotation.</p>
<pre class="r"><code>## keep label and source in a separate variables
label &lt;- unique(incidence$label)
data_source &lt;- unique(incidence$source)
updated &lt;- unique(incidence$updated)
label</code></pre>
<pre><code>## [1] &quot;New cases of malignant neoplasms&quot;</code></pre>
<pre class="r"><code>data_source</code></pre>
<pre><code>## [1] &quot;Estonian Cancer Registry&quot;</code></pre>
<pre class="r"><code>updated</code></pre>
<pre><code>## [1] &quot;2015-06-18T08:31:00Z&quot;</code></pre>
<p>Table metadata shows that values are <strong>new cases of malignant neoplasms</strong> and originate from <strong>Estonian Cancer Registry</strong> and were last time updated in <strong>2015-06-18</strong>.</p>
<p>We also want to trim those offending dots from beginning of “Specified site” names and rename “Specified site” into something more convenient, like “Site”.</p>
<p>We use <code>stri_trim_left()</code> from “stringi” to trim all characters from the beginning of strings <strong>until first alphabetic character</strong> (<code>?regex</code>). Finally, to exclude table metadata constants, we use <code>select()</code> from “dplyr”.</p>
<pre class="r"><code>## Trim characters from `Specified site` until first [[:alpha:]], 
## we rename `Specified site` and constant columns from table
incidence &lt;- mutate(incidence, 
                Site = stri_trim_left(`Specified site`, &quot;[[:alpha:]]&quot;)) %&gt;% 
  select(-`Specified site`, -label, -source, -updated)</code></pre>
<blockquote>
<p>Table is in the wide format, we want to convert it into long/tidy format and filter out missing data.</p>
</blockquote>
<p><strong>Reshape data</strong>. Values are in the age group columns. We try to reshape table such as the age groups go into “age” column and values will be in the column called “cases”. We use <code>gather()</code> from “tidyr” library to bring age group values into one column and cases values into the other. Here we also need to supply the names of the value columns, otherwise <code>gather()</code> will put all categorical variables into the key column and all numeric values into value column.</p>
<pre class="r"><code>## Let&#39;s look what happens when we run gather on our data
gather(incidence)</code></pre>
<pre><code>## # A tibble: 45,990 x 2
##      key value
##    &lt;chr&gt; &lt;chr&gt;
##  1  Year  2000
##  2  Year  2000
##  3  Year  2000
##  4  Year  2000
##  5  Year  2000
##  6  Year  2000
##  7  Year  2000
##  8  Year  2000
##  9  Year  2000
## 10  Year  2000
## # ... with 45,980 more rows</code></pre>
<p>Not what we want!</p>
<blockquote>
<p>It might not be always clear what <code>gather()</code> result will look like, you might need several iterations to get expected result.</p>
</blockquote>
<p><strong>Select columns cleverly</strong>. Cancer cases data is in the age groups columns are labelled from <code>0-4</code> to <code>85 and older</code>, we need to supply the names of these columns to <code>gather()</code>.</p>
<p>We can do this by supplying the names of all 18 age group columns to function (risking with typos and we need to backquote these names because of dash characters) or we can <strong>do this in the smart way</strong>.</p>
<p>“dplyr” has <strong>select helper functions</strong> <code>?select_helpers</code> to select columns based on patterns in their names.</p>
<p>One such function is <code>matches()</code>: matches a regular expression (<code>?regex</code>). Here we need to match columns with numbers in their names. Regular expression matching zero or more numbers is <code>&quot;[[:digit:]]+&quot;</code>.</p>
<p>Let’s run test first using character vector of column names:</p>
<pre class="r"><code>colnames(incidence)</code></pre>
<pre><code>##  [1] &quot;Year&quot;         &quot;Sex&quot;          &quot;0-4&quot;          &quot;5-9&quot;         
##  [5] &quot;10-14&quot;        &quot;15-19&quot;        &quot;20-24&quot;        &quot;25-29&quot;       
##  [9] &quot;30-34&quot;        &quot;35-39&quot;        &quot;40-44&quot;        &quot;45-49&quot;       
## [13] &quot;50-54&quot;        &quot;55-59&quot;        &quot;60-64&quot;        &quot;65-69&quot;       
## [17] &quot;70-74&quot;        &quot;75-79&quot;        &quot;80-84&quot;        &quot;85 and older&quot;
## [21] &quot;Site&quot;</code></pre>
<pre class="r"><code>colnames(incidence) %&gt;% matches(&quot;[[:digit:]]+&quot;, vars = .)</code></pre>
<pre><code>##  [1]  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20</code></pre>
<p>We can see that “[[:digit:]]+” matches columns 4 to 21. Seems like it works!</p>
<p>Here we use <code>gather()</code> to collect age group columns selected by <code>matches(&quot;[[:digit:]]+&quot;)</code> into columns “age” and “cases”.</p>
<pre class="r"><code>## Values are in the age group columns
incidence_long &lt;- gather(data = incidence, 
                         key = &quot;age&quot;, 
                         value = &quot;cases&quot;, 
                         matches(&quot;[[:digit:]]+&quot;))
incidence_long</code></pre>
<pre><code>## # A tibble: 39,420 x 5
##     Year   Sex
##    &lt;dbl&gt; &lt;chr&gt;
##  1  2000   Men
##  2  2000 Women
##  3  2000   Men
##  4  2000 Women
##  5  2000   Men
##  6  2000 Women
##  7  2000   Men
##  8  2000 Women
##  9  2000   Men
## 10  2000 Women
## # ... with 39,410 more rows, and 3 more variables: Site &lt;chr&gt;, age &lt;chr&gt;,
## #   cases &lt;int&gt;</code></pre>
<p>Now we have each value on separate row and can filter out missing values. Currently missing values are explicitly labeled with NA-s. Function <code>complete.cases()</code> gives logical vector indicating rows with no missing values (no NA-s). Based on this logical vector, <code>filter()</code> then keeps only <code>TRUE</code> rows.</p>
<pre class="r"><code>## Filter out missing data,
incidence_long &lt;- incidence_long %&gt;% filter(complete.cases(.))
## above is same as:
## filter(cases_long, complete.cases(cases_long))
## omit.na(incidence_long)</code></pre>
<p>Before filtering missing values table had 39420 rows and after 39420. <strong>Looks that we don’t have any NA in our table!</strong></p>
<p>That’s all with data wrangling for now!</p>
</div>
<div id="cancer-trend-in-estonia" class="section level2">
<h2>Cancer trend in Estonia</h2>
<p>It’s quite simple, we have already summary data available in our table under variable called “All malignant neoplasms (C00-C97)” in Site column. We plot this variable versus Years and for begginning we lump together men and women:.</p>
<pre class="r"><code>total_cases_per_year &lt;- incidence_long %&gt;% 
  filter(Site == &quot;All malignant neoplasms (C00-C97)&quot;) %&gt;% 
  group_by(Year) %&gt;% 
  summarise(total_cases = sum(cases))
total_cases_per_year</code></pre>
<pre><code>## # A tibble: 15 x 2
##     Year total_cases
##    &lt;dbl&gt;       &lt;int&gt;
##  1  2000        6032
##  2  2001        6237
##  3  2002        6119
##  4  2003        6378
##  5  2004        6813
##  6  2005        6525
##  7  2006        7190
##  8  2007        7280
##  9  2008        7330
## 10  2009        7391
## 11  2010        7841
## 12  2011        8204
## 13  2012        8245
## 14  2013        8420
## 15  2014        8558</code></pre>
<pre class="r"><code>## We direct plot to an object, then we can reuse it
p &lt;- total_cases_per_year %&gt;% 
  ggplot(aes(Year, total_cases)) +
  geom_point() +
  geom_line() +
  ylab(str_wrap(label, width = 40)) +
  ggtitle(&quot;All malignant neoplasms (C00-C97)&quot;,
          subtitle = paste(&quot;Source:&quot;, data_source))
p</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-16-1.svg" width="672" /></p>
<p>We can see that cancer cases are skyrocketing.</p>
<p>To better examplify this trend, we can add linear model fit to the plot using <code>geom_smooth()</code> function from “ggplot2”. It is also good idea to start y-axis from 0 in order to decrease lie factor – we might perceive trend larger than it actually is.</p>
<p>We created ggplot object “p” in the previous code chunk, we can modify this ggplot object by adding new geoms:</p>
<pre class="r"><code>p + 
  geom_smooth(method = &quot;lm&quot;, se = FALSE) + 
  expand_limits(y = 0)</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-17-1.svg" width="672" /></p>
<p>Ok, trend is increasing, but how much increase have we seen compared 2014 to 2000?</p>
<pre class="r"><code>total_cases_per_year %&gt;% 
  filter(Year %in% c(2000, 2014)) %&gt;% 
  knitr::kable(col.names = c(&quot;Year&quot;, &quot;Number of total cases&quot;))</code></pre>
<table>
<thead>
<tr class="header">
<th align="right">Year</th>
<th align="right">Number of total cases</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">2000</td>
<td align="right">6032</td>
</tr>
<tr class="even">
<td align="right">2014</td>
<td align="right">8558</td>
</tr>
</tbody>
</table>
<p>How many percent?</p>
<pre class="r"><code>total_cases_per_year %&gt;% 
  filter(Year %in% c(2000, 2014)) %&gt;% 
  summarise(perc_increase = sprintf(&quot;%1.0f%%&quot;, (1 - total_cases[Year==2000]/total_cases[Year==2014])*100))</code></pre>
<pre><code>## # A tibble: 1 x 1
##   perc_increase
##           &lt;chr&gt;
## 1           30%</code></pre>
<p><strong>Is the number of cases similar in males and females?</strong> Again, we look on the all types of cancer, but split dataset by Sex:</p>
<pre class="r"><code>## summarise data per Year and Sex
total_cases_per_year_sex &lt;- incidence_long %&gt;% 
  filter(Site == &quot;All malignant neoplasms (C00-C97)&quot;) %&gt;% 
  group_by(Year, Sex) %&gt;% 
  summarise(total_cases = sum(cases)) 
## Plot this new summary
total_cases_per_year_sex %&gt;% 
  ggplot(aes(Year, total_cases, color = Sex)) +
  geom_point() +
  geom_line() +
  ylab(label) +
  ggtitle(&quot;All malignant neoplasms (C00-C97)&quot;,
          subtitle = paste(&quot;Source:&quot;, data_source))</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-20-1.svg" width="672" /></p>
<p>We can see that cancer prevalence seems to be similar in both gender – the number of female and male cancer patients is similar. We might have some prior information, that there are more women than men in population. The question arises whether men and women still get cancer at the same rate?</p>
<p>So we have seen increasing numbers of new cases each year during 2000 and 2014. Do we have more cancer or does this reflects increase in population size?</p>
<p>To answer these question, we need population size normalised values of cancer cases – <strong>incidence</strong>. Cancer incidence is obtained by dividing cancer prevalence with population size.</p>
<p><strong>incidence = (number of cases / mean annual population) * 100000</strong></p>
<p>Vähi intsidents on uute mingit tüüpi vähijuhtude arv aastas vastavas populatsioonis. Uute juhtude arv võib sisaldada mitmeid ühelt patsiendilt leitud primaarseid vähikoldeid. Primaarne vähisait on see kustkohas see vähk algselt on tekkinud, mitte metastaas. Intsidents ei sisalda tagasi tulnud vähke. Populatsiooni suurus sõltub missugusele kasvajale või kasvajagrupile intsidentsi arvutatakse. Kui näiteks arvutatakse emakakaela vähi intsidentsi, siis kasutatakse ainult naiste populatsiooni suurust.</p>
<p>Vanusrühmade suuruse suhtes kaalutud intsidents ehk vanuskordajad arvutatakse kaalutud keskmise meetodil, kus kaalud saadakse vanuserühmade suurusest.</p>
</div>
<div id="vanuserahmade-suuruse-suhtes-kaalutud-vahi-intsidents" class="section level2">
<h2>Vanuserähmade suuruse suhtes kaalutud vähi intsidents</h2>
<p>Vähi vanuskordajate arvutamiseks on meil puudu populatsioonisuurused.</p>
<p>We obtained mean annual population data from Statistics Estonia. You can download this dataset from “<a href="https://github.com/rstats-tartu/datasets">rstats-tartu/datasets</a>” repo.</p>
<p>Download population data into our projects “data” subfolder:</p>
<pre class="r"><code>if(!file.exists(&quot;data/mean_annual_population.csv&quot;)){
  download.file(&quot;https://raw.githubusercontent.com/rstats-tartu/datasets/master/mean_annual_population.csv&quot;, &quot;data/mean_annual_population.csv&quot;)
}</code></pre>
<p>Import mean annual population data.</p>
<pre class="r"><code>## Read in data
pop &lt;- read_csv(&quot;data/mean_annual_population.csv&quot;)</code></pre>
<pre><code>## Parsed with column specification:
## cols(
##   .default = col_integer(),
##   Sex = col_character()
## )</code></pre>
<pre><code>## See spec(...) for full column specifications.</code></pre>
<pre class="r"><code>pop</code></pre>
<pre><code>## # A tibble: 94 x 21
##      Sex  Year   `0` `1-4` `5-9` `10-14` `15-19` `20-24` `25-29` `30-34`
##    &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;   &lt;int&gt;   &lt;int&gt;   &lt;int&gt;   &lt;int&gt;   &lt;int&gt;
##  1   Men  1970 10315 39493 51950   51417   53084   53787   47058   55210
##  2   Men  1971 11008 40589 51387   52276   53190   56042   45176   56373
##  3   Men  1972 11149 42371 50441   53196   53286   57535   45007   56006
##  4   Men  1973 10889 43778 49961   53545   53861   58084   47523   53213
##  5   Men  1974 10757 44504 50093   53287   54508   57978   51560   49706
##  6   Men  1975 10877 44778 50826   52456   55127   58244   55310   46561
##  7   Men  1976 10929 44601 52426   51348   55631   58850   57584   44378
##  8   Men  1977 11079 44326 54237   50155   55903   59217   58757   44123
##  9   Men  1978 11032 44416 55384   49553   55806   59620   59224   46277
## 10   Men  1979 11028 44626 55816   49927   55368   59309   59246   49727
## # ... with 84 more rows, and 11 more variables: `35-39` &lt;int&gt;,
## #   `40-44` &lt;int&gt;, `45-49` &lt;int&gt;, `50-54` &lt;int&gt;, `55-59` &lt;int&gt;,
## #   `60-64` &lt;int&gt;, `65-69` &lt;int&gt;, `70-74` &lt;int&gt;, `75-79` &lt;int&gt;,
## #   `80-84` &lt;int&gt;, `85 and older` &lt;int&gt;</code></pre>
<p>We can see that population size data is in wide format and we have separate columns for age groups “0” and “1-4” that we don’t have in our cancer data. In cancer data we have age group “0-4” instead.</p>
<p>We need to summarise age groups “0” and “1-4” into “0-4”, drop “0” and “1-4” and then convert table to long format using <code>gather()</code>.</p>
<pre class="r"><code>## Summarise 0 and 1-4 to 0-4 age group, keep only the latter
pop_long &lt;- mutate(pop, &quot;0-4&quot; = `0` + `1-4`) %&gt;% 
  select(-`0`, -`1-4`) %&gt;% 
  gather(&quot;age&quot;, &quot;ave_pop&quot;, matches(&quot;^[[:digit:]]&quot;))
pop_long</code></pre>
<pre><code>## # A tibble: 1,692 x 4
##      Sex  Year   age ave_pop
##    &lt;chr&gt; &lt;int&gt; &lt;chr&gt;   &lt;int&gt;
##  1   Men  1970   5-9   51950
##  2   Men  1971   5-9   51387
##  3   Men  1972   5-9   50441
##  4   Men  1973   5-9   49961
##  5   Men  1974   5-9   50093
##  6   Men  1975   5-9   50826
##  7   Men  1976   5-9   52426
##  8   Men  1977   5-9   54237
##  9   Men  1978   5-9   55384
## 10   Men  1979   5-9   55816
## # ... with 1,682 more rows</code></pre>
<p>Merge cancer cases with population size data. Note that population values only from years 2000 to 2014 will be merged to incidence_long.</p>
<pre class="r"><code>incidence_long &lt;- left_join(incidence_long, pop_long)</code></pre>
<pre><code>## Joining, by = c(&quot;Year&quot;, &quot;Sex&quot;, &quot;age&quot;)</code></pre>
<pre class="r"><code>incidence_long</code></pre>
<pre><code>## # A tibble: 39,420 x 6
##     Year   Sex
##    &lt;dbl&gt; &lt;chr&gt;
##  1  2000   Men
##  2  2000 Women
##  3  2000   Men
##  4  2000 Women
##  5  2000   Men
##  6  2000 Women
##  7  2000   Men
##  8  2000 Women
##  9  2000   Men
## 10  2000 Women
## # ... with 39,410 more rows, and 4 more variables: Site &lt;chr&gt;, age &lt;chr&gt;,
## #   cases &lt;int&gt;, ave_pop &lt;int&gt;</code></pre>
<p>Cancer incidence is presented as new cases per 100’000. Now we have number of new cases and population size side-by-side and can go on to calculate cancer incidence per 100’000 inhabitans:</p>
<pre class="r"><code>incidence_year_sex &lt;- incidence_long %&gt;% 
  group_by(Site, Year, Sex) %&gt;% 
  summarise(cases = sum(cases),
            ave_pop = sum(ave_pop)) %&gt;% 
  mutate(incidence = (cases / ave_pop) * 100000)
## we selected less columns for viewing
select(incidence_year_sex, Site, Year, incidence, everything())</code></pre>
<pre><code>## # A tibble: 2,190 x 6
## # Groups:   Site, Year [1,095]
##                                     Site  Year incidence   Sex cases
##                                    &lt;chr&gt; &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;int&gt;
##  1 Acute lymphoblastic leukaemia (C91.0)  2000 0.7679607   Men     5
##  2 Acute lymphoblastic leukaemia (C91.0)  2000 0.9384510 Women     7
##  3 Acute lymphoblastic leukaemia (C91.0)  2001 0.6185392   Men     4
##  4 Acute lymphoblastic leukaemia (C91.0)  2001 1.0789960 Women     8
##  5 Acute lymphoblastic leukaemia (C91.0)  2002 1.5572807   Men    10
##  6 Acute lymphoblastic leukaemia (C91.0)  2002 0.5425899 Women     4
##  7 Acute lymphoblastic leukaemia (C91.0)  2003 1.5680863   Men    10
##  8 Acute lymphoblastic leukaemia (C91.0)  2003 1.3642565 Women    10
##  9 Acute lymphoblastic leukaemia (C91.0)  2004 1.1048329   Men     7
## 10 Acute lymphoblastic leukaemia (C91.0)  2004 0.8230791 Women     6
## # ... with 2,180 more rows, and 1 more variables: ave_pop &lt;int&gt;</code></pre>
<p>Let’s see if we got correct number by comparing our incidence numbers to ones published in <a href="http://pxweb.tai.ee/PXWeb2015/pxweb/en/02Haigestumus/02Haigestumus__04Pahaloomulised%20kasvajad/PK30.px/table/tableViewLayout2/?rxid=99c3b4bb-c5a7-466d-9f66-2744870afcd7">Estonian Health Statistics database</a>:</p>
<pre class="r"><code>incidence_year_sex %&gt;% 
  filter(Site == &quot;All malignant neoplasms (C00-C97)&quot;,
         Year == 2000) %&gt;% 
  select(-Site, -cases, -ave_pop) %&gt;% 
  knitr::kable()</code></pre>
<pre><code>## Adding missing grouping variables: `Site`</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">Site</th>
<th align="right">Year</th>
<th align="left">Sex</th>
<th align="right">incidence</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">All malignant neoplasms (C00-C97)</td>
<td align="right">2000</td>
<td align="left">Men</td>
<td align="right">448.1819</td>
</tr>
<tr class="even">
<td align="left">All malignant neoplasms (C00-C97)</td>
<td align="right">2000</td>
<td align="left">Women</td>
<td align="right">417.4766</td>
</tr>
</tbody>
</table>
<p><br></p>
<div class="figure">
<img src="img/verify_incidence.png" alt="Cancer incidence values of All malignant neoplasms for year 2000 in Estonian Health Statistics database." width="600" />
<p class="caption">
Cancer incidence values of All malignant neoplasms for year 2000 in Estonian Health Statistics database.
</p>
</div>
<p><br></p>
<blockquote>
<p>Seems that we are calculating cancer incidence similarly as professional statisticians.</p>
</blockquote>
<p><br></p>
<p><strong>Men get more cancer in Estonia.</strong> Clearly, increasing trend for new cancer cases is still visible after normalisation for population size. However, incidence uncovers another important trend, namely, men tend to get more cancer than women in Estonia. While the number of cases per year was similar in men and women, the incidence is higher in men:</p>
<pre class="r"><code>total_incidence_year_sex &lt;- incidence_year_sex %&gt;% 
  filter(Site == &quot;All malignant neoplasms (C00-C97)&quot;)
## we give new data to plot and we also must supply aes for Sex
total_incidence_year_sex %&gt;% 
  ggplot(aes(Year, incidence, color = Sex)) +
  geom_point() +
  geom_line() +
  ylab(&quot;Cancer incidence per 100&#39;000&quot;) +
  ggtitle(&quot;All malignant neoplasms (C00-C97)&quot;,
          subtitle = paste(&quot;Source:&quot;, data_source))</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-27-1.svg" width="672" /></p>
<p>Is increasing incidence trend comparable to the increase in number of cases? We can try to look at this by calculating percent increase in 2014 compared to 2000.</p>
<table>
<thead>
<tr class="header">
<th align="left">Sex</th>
<th align="left">Increase</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Men</td>
<td align="left">35%</td>
</tr>
<tr class="even">
<td align="left">Women</td>
<td align="left">32%</td>
</tr>
</tbody>
</table>
<p>We can see that compared to counts of new cases both men and women show even bigger increase in cancer rates in Estonia. Do we get more cancer or do we diagnose more cancer… ?</p>
<blockquote>
<p>We can settle that cancer trend in Estonia is worryingly increasing.</p>
</blockquote>
</div>
<div id="what-are-the-most-frequent-cancer-sites" class="section level2">
<h2>What are the most frequent cancer sites?</h2>
<p>Let’s have a look at Top10 most frequent cancers. Most frequent cancers are different in men and women.</p>
<p>First, we try to remove some summary variables from table. “boulder” package has <em>adhoc</em> function <code>icd_sums()</code> that tries to id rows that contain summary data over many cancer sites using ICD codes in “Sites” strings.</p>
<pre class="r"><code>## boulder has adhoc function that tries to id parent Sites
parent_nodes &lt;- boulder::icd_sums(unique(incidence_long$Site))
parent_nodes</code></pre>
<pre><code>## # A tibble: 181 x 2
##                               Parent
##                                &lt;chr&gt;
##  1 All malignant neoplasms (C00-C97)
##  2 All malignant neoplasms (C00-C97)
##  3 All malignant neoplasms (C00-C97)
##  4 All malignant neoplasms (C00-C97)
##  5 All malignant neoplasms (C00-C97)
##  6 All malignant neoplasms (C00-C97)
##  7 All malignant neoplasms (C00-C97)
##  8 All malignant neoplasms (C00-C97)
##  9 All malignant neoplasms (C00-C97)
## 10 All malignant neoplasms (C00-C97)
## # ... with 171 more rows, and 1 more variables: Site &lt;chr&gt;</code></pre>
<p>Create vector for subsetting:</p>
<pre class="r"><code>unique_parents &lt;- unique(parent_nodes$Parent)</code></pre>
<blockquote>
<p>This can be also achieved by “manually” specifying Site values to be omitted.</p>
</blockquote>
</div>
<div id="find-most-frequent-cancer-sites" class="section level2">
<h2>Find most frequent cancer sites</h2>
<p>We calculate incidence for each Site per Sex, let’s drop Year by taking its average:</p>
<pre class="r"><code>incidence_sex_filt &lt;- incidence_year_sex %&gt;% 
  filter(!Site %in% unique_parents) %&gt;% 
  group_by(Site, Sex) %&gt;% 
  summarise(incidence = mean(incidence))
incidence_sex_filt</code></pre>
<pre><code>## # A tibble: 120 x 3
## # Groups:   Site [?]
##                                      Site   Sex  incidence
##                                     &lt;chr&gt; &lt;chr&gt;      &lt;dbl&gt;
##  1  Acute lymphoblastic leukaemia (C91.0)   Men  1.2020502
##  2  Acute lymphoblastic leukaemia (C91.0) Women  1.0957165
##  3        Acute myeloid leukaemia (C92.0)   Men  2.8776086
##  4        Acute myeloid leukaemia (C92.0) Women  3.0853415
##  5                          Bladder (C67)   Men 25.7340246
##  6                          Bladder (C67) Women  8.1800575
##  7 Bone and articular cartilage (C40-C41)   Men  1.3889258
##  8 Bone and articular cartilage (C40-C41) Women  0.7791062
##  9                            Brain (C71)   Men  7.4869174
## 10                            Brain (C71) Women  6.4476983
## # ... with 110 more rows</code></pre>
<p>List of top10 cancers by Sex:</p>
<pre class="r"><code>## list of top10 cancers
listof_top10 &lt;- incidence_sex_filt %&gt;% 
  group_by(Sex) %&gt;% 
  top_n(10, incidence) %&gt;% 
  arrange(desc(incidence))
listof_top10</code></pre>
<pre><code>## # A tibble: 20 x 3
## # Groups:   Sex [2]
##                                   Site   Sex incidence
##                                  &lt;chr&gt; &lt;chr&gt;     &lt;dbl&gt;
##  1                      Prostate (C61)   Men 133.08185
##  2   Trachea, bronchus, lung (C33-C34)   Men  96.15237
##  3                        Breast (C50) Women  90.47996
##  4                 Skin (others) (C44) Women  79.09734
##  5                 Skin (others) (C44)   Men  53.96362
##  6                         Colon (C18) Women  37.59027
##  7                       Stomach (C16)   Men  36.43324
##  8                         Colon (C18)   Men  32.33435
##  9                  Corpus uteri (C54) Women  28.24725
## 10      Kidney, renal pelvis (C64-C65)   Men  26.95186
## 11                       Stomach (C16) Women  26.42107
## 12                       Bladder (C67)   Men  25.73402
## 13         Rectum and others (C19-C21)   Men  24.95321
## 14   Trachea, bronchus, lung (C33-C34) Women  24.40774
## 15                  Cervix uteri (C53) Women  24.26342
## 16                         Ovary (C56) Women  21.94703
## 17         Rectum and others (C19-C21) Women  21.76053
## 18                      Pancreas (C25)   Men  18.00857
## 19      Kidney, renal pelvis (C64-C65) Women  17.12987
## 20 Non-Hodgkin&#39;s lymphoma (C82-C85/96)   Men  12.27523</code></pre>
<p>Plot most frequent cancers:</p>
<pre class="r"><code>incidence_sex_filt %&gt;% 
  filter(Site %in% listof_top10$Site) %&gt;% 
  ggplot(aes(Sex, incidence)) +
  geom_bar(stat = &quot;identity&quot;) + ## use the values that we have in our table
  facet_wrap(~ Site, labeller = label_wrap_gen(width = 20)) +
  labs(title = &quot;Top10 cancer sites from both genders&quot;,
       subtitle = &quot;Mean annual incidence from years 2000 to 2014&quot;,
       y = &quot;Cancer incidence per 100000&quot;,
       caption = paste(&quot;Source:&quot;, data_source)) +
  theme(axis.title.x = element_blank())</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-33-1.svg" width="672" /></p>
<p>Here is another take using the same data:</p>
<pre class="r"><code>incidence_sex_filt %&gt;%
  filter(Site %in% listof_top10$Site) %&gt;% 
  ggplot(aes(reorder(Site, incidence), incidence, fill = Sex)) +
  geom_bar(stat = &quot;identity&quot;) +
  labs(y = &quot;Cancer incidence per 100000&quot;,
       title = &quot;Top10 cancer sites from both genders&quot;,
       subtitle = &quot;Mean annual incidence from years 2000 to 2014&quot;,
       caption = paste(&quot;Data:&quot;, data_source)) +
  coord_flip() +
  theme(axis.title.y = element_blank(),
        legend.title = element_blank()) +
  scale_fill_manual(values = c(&quot;darkgray&quot;, &quot;orange&quot;))</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-34-1.svg" width="672" /></p>
<p>What these two graphs tell us?</p>
</div>
<div id="cancer-takes-whole-life-to-develop" class="section level2">
<h2>Cancer takes whole life to develop</h2>
<p>Which age groups get most cancer? Number of new cases versus incidence.</p>
<p>First, we also make age groups numeric for correct x-axis order.</p>
<pre class="r"><code>numeric_agegroup &lt;- function(x) parse_number(str_extract(x, &quot;^[0-9]{1,2}&quot;))
incidence_long &lt;- incidence_long %&gt;% mutate_at(&quot;age&quot;, numeric_agegroup)
incidence_long</code></pre>
<pre><code>## # A tibble: 39,420 x 6
##     Year   Sex
##    &lt;dbl&gt; &lt;chr&gt;
##  1  2000   Men
##  2  2000 Women
##  3  2000   Men
##  4  2000 Women
##  5  2000   Men
##  6  2000 Women
##  7  2000   Men
##  8  2000 Women
##  9  2000   Men
## 10  2000 Women
## # ... with 39,410 more rows, and 4 more variables: Site &lt;chr&gt;, age &lt;dbl&gt;,
## #   cases &lt;int&gt;, ave_pop &lt;int&gt;</code></pre>
<p>Let’s plot cancer incidence versus age groups.</p>
<pre class="r"><code>p &lt;- incidence_long %&gt;% 
  filter(Site %in% listof_top10$Site) %&gt;%
  mutate(incidence = (cases / ave_pop) * 100000) %&gt;% 
  group_by(Sex, Site, age) %&gt;% 
  summarise(incidence = mean(incidence)) %&gt;% 
  ggplot(aes(age, incidence, color = Sex)) +
  geom_line() +
  facet_wrap(~ Site, labeller = label_wrap_gen(20), scales = &quot;free_y&quot;) +
  scale_color_manual(values = c(&quot;darkgray&quot;, &quot;orange&quot;))
p</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-36-1.svg" width="672" /> We can see that generally cancer incidence peaks at the age of 60+. There are exeptions, like cervical cancer which has peak incidence in 40 year olds.</p>
<p>Cancer incidence increases with age: use log on x and y axis!</p>
<pre class="r"><code>incidence_long %&gt;% 
  filter(Site %in% listof_top10$Site) %&gt;%
  mutate(incidence = cases / (ave_pop/1E5)) %&gt;% 
  group_by(Sex, Site, age) %&gt;% 
  summarise(incidence = mean(incidence)) %&gt;% 
  mutate_at(vars(age, incidence), log) %&gt;% 
  filter(is.finite(incidence), is.finite(age)) %&gt;% 
  ggplot(aes(age, incidence, color = Sex)) +
  geom_point() +
  facet_wrap(~ Site, labeller = label_wrap_gen(20), scales = &quot;free_y&quot;) +
  scale_color_manual(values = c(&quot;darkgray&quot;, &quot;orange&quot;)) +
  geom_smooth(method = &quot;lm&quot;)</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-37-1.svg" width="672" /></p>
<p>There are cancer that show linear relationship between age and incidence, like skin cancer and bladder cancer. And there are cancers that initially show increase but then reach plateau, these seem to be mostly gender specific cancers like breast cancer, cervical cancer, and endometrial cancer in women and prostate cancer in men. If you compare breast cancer in women and men, then it seems that they have different mechanism…</p>
</div>
<div id="weighted-averages" class="section level2">
<h2>Weighted averages</h2>
<p>Previous calculation we summarised all age groups to calculate cancer total population incidence. However, age groups in population are of different size and different cancer prevalence.</p>
<p>Let’s try to take into account age-dependent differences in population size when calculating incidence – by population size as weight.</p>
<p>Plot population sizes of different age groups:</p>
<pre class="r"><code>## install.packages(&quot;viridis&quot;)
library(viridis)</code></pre>
<pre><code>## Loading required package: viridisLite</code></pre>
<pre class="r"><code>## Plot age group differences
incidence_long %&gt;% 
  ungroup() %&gt;% 
  select(Year, age, Sex, ave_pop) %&gt;%
  distinct() %&gt;% 
  ggplot(aes(age, ave_pop, color = Sex, group = Sex)) +
  geom_jitter(jitter = 0.1) +
  geom_smooth(method = &quot;loess&quot;, se = FALSE) +
  labs(title = &quot;Population sizes of different age groups in Estonia&quot;,
       subtitle = &quot;Years 2000 to 2014&quot;,
       caption = &quot;Data: Statistics Estonia.&quot;,
       y = &quot;Mean annual population&quot;,
       x = &quot;Age groups&quot;) +
  scale_color_viridis(discrete = TRUE)</code></pre>
<pre><code>## Warning: Ignoring unknown parameters: jitter</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-38-1.svg" width="672" /></p>
<p>Let’s calculate age group size weighted incidence values. For comparison, first we recalculate raw incidence and then age-weighted incidence. To calculate raw incidence, we first sum up all cases and population size over age groups. Then we drop Year by calculating mean incidence across years.</p>
<pre class="r"><code>## raw incidence
raw_incidence &lt;- incidence_long %&gt;% 
  group_by(Year, Site, Sex) %&gt;% 
  summarise(cases = sum(cases),
            ave_pop = sum(ave_pop)) %&gt;% 
  mutate(incidence = (cases / ave_pop) * 100000) %&gt;% ## incidence
  group_by(Site, Sex) %&gt;% 
  summarise(incidence = mean(incidence),
            ave_pop = mean(ave_pop))
raw_incidence</code></pre>
<pre><code>## # A tibble: 146 x 4
## # Groups:   Site [?]
##                                                                 Site   Sex
##                                                                &lt;chr&gt; &lt;chr&gt;
##  1                             Acute lymphoblastic leukaemia (C91.0)   Men
##  2                             Acute lymphoblastic leukaemia (C91.0) Women
##  3                                   Acute myeloid leukaemia (C92.0)   Men
##  4                                   Acute myeloid leukaemia (C92.0) Women
##  5                                               Adrenal gland (C74)   Men
##  6                                               Adrenal gland (C74) Women
##  7                                 All malignant neoplasms (C00-C97)   Men
##  8                                 All malignant neoplasms (C00-C97) Women
##  9 All malignant neoplasms except skin (other) (C00-C97, except C44)   Men
## 10 All malignant neoplasms except skin (other) (C00-C97, except C44) Women
## # ... with 136 more rows, and 2 more variables: incidence &lt;dbl&gt;,
## #   ave_pop &lt;dbl&gt;</code></pre>
<p>In order to calculate age-weighted incidence we should follow diferent logic. Here we start by calculating incidence for each data split in our table: Year, Site, Sex, age. Then we go on and calculate mean incidence and average pop size across Years. Then we apply weights and calculate weighted average.</p>
<pre class="r"><code>## Age weighted incidence
age_weighted_incidence &lt;- incidence_long %&gt;% 
  mutate(incidence = (cases / ave_pop) * 100000) %&gt;% ## incidence
  group_by(Site, Sex, age) %&gt;% ## calculate mean population size and mean incidence across years
  summarise(incidence = mean(incidence), 
            ave_pop = mean(ave_pop)) %&gt;% 
  mutate(wt = ave_pop / sum(ave_pop), ## calculate and apply weights
         incidence = wt * incidence) %&gt;% 
  summarise(incidence = sum(incidence), ## calulate weighted average
            ave_pop = sum(ave_pop))
age_weighted_incidence</code></pre>
<pre><code>## # A tibble: 146 x 4
## # Groups:   Site [?]
##                                                                 Site   Sex
##                                                                &lt;chr&gt; &lt;chr&gt;
##  1                             Acute lymphoblastic leukaemia (C91.0)   Men
##  2                             Acute lymphoblastic leukaemia (C91.0) Women
##  3                                   Acute myeloid leukaemia (C92.0)   Men
##  4                                   Acute myeloid leukaemia (C92.0) Women
##  5                                               Adrenal gland (C74)   Men
##  6                                               Adrenal gland (C74) Women
##  7                                 All malignant neoplasms (C00-C97)   Men
##  8                                 All malignant neoplasms (C00-C97) Women
##  9 All malignant neoplasms except skin (other) (C00-C97, except C44)   Men
## 10 All malignant neoplasms except skin (other) (C00-C97, except C44) Women
## # ... with 136 more rows, and 2 more variables: incidence &lt;dbl&gt;,
## #   ave_pop &lt;dbl&gt;</code></pre>
<p>Plot results side by side.</p>
<pre class="r"><code>bind_rows(list(raw_incidence, age_weighted_incidence), .id = &quot;type&quot;) %&gt;% 
  filter(Site %in% listof_top10$Site) %&gt;%
  ggplot(aes(Sex, incidence, fill = type)) +
  geom_bar(stat = &quot;identity&quot;, position = &quot;dodge&quot;) +
  facet_wrap(~ Site, labeller = label_wrap_gen(20), scales = &quot;free_y&quot;) +
  scale_fill_viridis(discrete = TRUE, labels = c(&quot;Raw&quot;, &quot;Age-\nweighted&quot;), &quot;Incidence&quot;) +
  labs(y = &quot;Cancer incidence per 100,000&quot;,
       title = &quot;Top10 cancer sites from both genders&quot;,
       subtitle = &quot;Mean annual incidence from years 2000 to 2014&quot;,
       caption = paste(&quot;Data:&quot;, data_source))</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-41-1.svg" width="672" /></p>
<p>As you can see, these values are in our case virtually similar.</p>
</div>
<div id="references" class="section level2 unnumbered">
<h2>References</h2>
<div id="refs" class="references">
<div id="ref-wickham2017r">
<p>Wickham, Hadley, and Garrett Grolemund. 2017. “R for Data Science.” O’Reilly Media. http://r4ds.had.co.nz.</p>
</div>
</div>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
