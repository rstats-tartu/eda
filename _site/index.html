<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="Taavi Päll" />


<title>Exploratory data analysis – Estonian cancer data</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/readable.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-1.1/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-1.1/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 66px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 71px;
  margin-top: -71px;
}

.section h2 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h3 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h4 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h5 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h6 {
  padding-top: 71px;
  margin-top: -71px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->






<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">EDA</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Exploratory data analysis – Estonian cancer data</h1>
<h4 class="author"><em>Taavi Päll</em></h4>
<h4 class="date"><em><ol start="26" style="list-style-type: decimal">
<li>Sept. 2017</li>
</ol></em></h4>

</div>


<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>Cancer and specially lung cancer is becoming one of the leading causes of mortality. In year 2012. cancer claimed 8.2 million lives worldwide, European Union had 15% share (1.27 million). Most cancer deaths are caused by lung-, liver-, stomach-, colorectal-, and breast cancer. Most frequent cancer types are different in females and males. Predictions show that cancer incidence increases from 14 million in 2012. to 22 million in 2030-ties.</p>
<p>Vähkkasvajad on maailmas üks juhtivatest surma põhjustatavatest haigustest, nõudes 8.2 miljonit elu 2012. aastal, sealhulgas on EU-27 osakaal 2012. aastal 1.27 miljonit ehk 15%. Kopsu-, maksa-, mao-, kolorektaal- ja rinnakasvajad põhjustavad enim vähisurmasid. Sagedasemad vähitüübid on naistel ja meestel erinevad. Ennustatakse et haigestumus suureneb maailmas 14 miljonilt 2012. aastal 22 miljonini 2030-ndatel.</p>
<p><br></p>
</div>
<div id="eda" class="section level2">
<h2>EDA</h2>
<p>Exploratory data analysis is iterative process <span class="citation">(Wickham and Grolemund 2017)</span> where you:</p>
<ol style="list-style-type: decimal">
<li><p>Generate questions about your data.</p></li>
<li><p>Search for answers by visualising, transforming, and modelling your data.</p></li>
<li><p>Use what you learn to refine your questions and/or generate new questions.</p></li>
</ol>
<p>Andmeanalüüs on iteratiivne protsess, kus:</p>
<ol style="list-style-type: decimal">
<li><p>Esitatakse esialgsed küsimused millele soovitakse antud andmete põhjal vastuseid;</p></li>
<li><p>Proovitakse neile küsimustele vastuseid leida, kasutades andmete visualiseerimit, transformeerimist ja modelleerimist;</p></li>
<li><p>Andmete põhjal saadud uute teadmiste najal täpsustatakse esitatavaid küsimusi ja tekivad uued küsimused <span class="citation">(Wickham and Grolemund 2017)</span>.</p></li>
</ol>
</div>
<div id="questions" class="section level2">
<h2>Questions</h2>
<p>By using cancer incidence data from Estonian Cancer Registry we want to understand:</p>
<ol style="list-style-type: decimal">
<li><p>What is the cancer incidence trend in Estonia?</p></li>
<li><p>What are the most frequent cancer sites?</p></li>
<li><p>What is the most frequent cancer type in men and in women?</p></li>
</ol>
<p><br></p>
<blockquote>
<p>However, when doing data analysis 80% of time will be spent on data munging where you also become familiar with your dataset. So it’s time well spent.</p>
</blockquote>
</div>
<div id="cancer-incidence-data-from-estonian-cancer-registry" class="section level2">
<h2>Cancer incidence data from Estonian cancer registry</h2>
<p>Estonian cancer registry data is available via <a href="http://pxweb.tai.ee/PXWeb2015/pxweb/en/02Haigestumus/02Haigestumus__04Pahaloomulised%20kasvajad/?tablelist=true&amp;rxid=279523e2-1ea1-4a02-920b-f85bb19a908d">Health statistics and health research database</a>. We are using cancer incidence dataset from table “PK30: Age-specific incidence rate of malignant neoplasms per 100 000 inhabitants by site and sex”.</p>
<p>Detailed information about variables in this dataset can be found from <a href="http://pxweb.tai.ee/PXWeb2015/pxweb/en/02Haigestumus/02Haigestumus__04Pahaloomulised%20kasvajad/PK30.px/?rxid=3155fc9b-3ab1-40b0-9e70-beadfb6af83c">here</a>.</p>
<p><br></p>
<div class="figure">
<img src="img/pk30-page.png" alt="Screen caption from dataset download page. Note that data was downloaded in JSON format." width="600" />
<p class="caption">
Screen caption from dataset download page. Note that data was downloaded in JSON format.
</p>
</div>
<p><br></p>
<p>For your convenience, we have downloaded this dataset into <a href="https://github.com/rstats-tartu/datasets">“rstats-tartu/datasets”</a> GitHub repo.</p>
<p><br></p>
</div>
<div id="create-rstudio-project" class="section level2">
<h2>Create RStudio project</h2>
<p>Create RStudio project from GitHub repo. <em>First</em>, create GitHub repo and call it <code>eda_demo</code>. <em>Second</em>, clone this repo into RStudio project. Detailed instructions can be found <a href="https://rstats-tartu.github.io/createrstudioprojectfromgithub/">here</a>.</p>
<p><br></p>
</div>
<div id="download-cancer-incidence-dataset-from-github" class="section level2">
<h2>Download cancer incidence dataset from GitHub</h2>
<p>Download “cancer_incidence_PK30.json” file from “rstats-tartu/datasets” GitHub repo:</p>
<pre class="r"><code>url &lt;- &quot;https://raw.githubusercontent.com/rstats-tartu/datasets/master/cancer_incidence_PK30.json&quot;
dir.create(&quot;data&quot;)
download.file(url, &quot;data/cancer_incidence_PK30.json&quot;)</code></pre>
<p><br></p>
</div>
<div id="import-and-prepare-data" class="section level2">
<h2>Import and prepare data</h2>
<p>First we download “tidyverse” library. We are going to need also “stringi” and “stringr” libraries for string manipulation (you guess correctly, stringr is based on stringi):</p>
<pre class="r"><code>library(tidyverse)
library(stringi)
library(stringr)</code></pre>
<p>Then we import dataset using <code>json_to_df()</code> function from “boulder” library.</p>
<p>You can install “boulder” from github “<a href="https://github.com/tpall/boulder">tpall/boulder</a>”: “boulder” package has few helper functions and was created to work specificly with Estonian Health Statistics and Health Research Database. However, “boulder” package is still under development and you should use it carefully.</p>
<pre class="r"><code># devtools::install_github(&quot;tpall/boulder&quot;)
library(boulder)
path &lt;- &quot;data/cancer_incidence_PK30.json&quot;
## json_to_df warns when data is not from Estonian Health Board
incidence &lt;- json_to_df(path)</code></pre>
<pre><code>## Data source is Estonian Cancer Registry.</code></pre>
<pre class="r"><code>incidence</code></pre>
<pre><code>## # A tibble: 2,190 x 24
##      Year
##    &lt;fctr&gt;
##  1   2000
##  2   2000
##  3   2000
##  4   2000
##  5   2000
##  6   2000
##  7   2000
##  8   2000
##  9   2000
## 10   2000
## # ... with 2,180 more rows, and 23 more variables: Site &lt;fctr&gt;,
## #   Sex &lt;fctr&gt;, `0-4` &lt;dbl&gt;, `5-9` &lt;dbl&gt;, `10-14` &lt;dbl&gt;, `15-19` &lt;dbl&gt;,
## #   `20-24` &lt;dbl&gt;, `25-29` &lt;dbl&gt;, `30-34` &lt;dbl&gt;, `35-39` &lt;dbl&gt;,
## #   `40-44` &lt;dbl&gt;, `45-49` &lt;dbl&gt;, `50-54` &lt;dbl&gt;, `55-59` &lt;dbl&gt;,
## #   `60-64` &lt;dbl&gt;, `65-69` &lt;dbl&gt;, `70-74` &lt;dbl&gt;, `75-79` &lt;dbl&gt;,
## #   `80-84` &lt;dbl&gt;, `85 and older` &lt;dbl&gt;, label &lt;chr&gt;, source &lt;chr&gt;,
## #   updated &lt;chr&gt;</code></pre>
<p><strong>Year, Site and Sex are factors.</strong> We convert Year to numeric and Site and Sex to character using <code>parse_</code> functions from “readr” package.</p>
<pre class="r"><code>## Year to numeric
incidence &lt;- incidence %&gt;% mutate_at(&quot;Year&quot;, parse_number)
## Site and Sex to character
incidence &lt;- incidence %&gt;% mutate_at(vars(Site, Sex), parse_character)
incidence</code></pre>
<pre><code>## # A tibble: 2,190 x 24
##     Year                                                              Site
##    &lt;dbl&gt;                                                             &lt;chr&gt;
##  1  2000                                 All malignant neoplasms (C00-C97)
##  2  2000                                 All malignant neoplasms (C00-C97)
##  3  2000 All malignant neoplasms except skin (other) (C00-C97, except C44)
##  4  2000 All malignant neoplasms except skin (other) (C00-C97, except C44)
##  5  2000                            Lip, oral cavity and pharynx (C00-C14)
##  6  2000                            Lip, oral cavity and pharynx (C00-C14)
##  7  2000                                                       ..Lip (C00)
##  8  2000                                                       ..Lip (C00)
##  9  2000                                                 ..Tongue (C01-02)
## 10  2000                                                 ..Tongue (C01-02)
## # ... with 2,180 more rows, and 22 more variables: Sex &lt;chr&gt;, `0-4` &lt;dbl&gt;,
## #   `5-9` &lt;dbl&gt;, `10-14` &lt;dbl&gt;, `15-19` &lt;dbl&gt;, `20-24` &lt;dbl&gt;,
## #   `25-29` &lt;dbl&gt;, `30-34` &lt;dbl&gt;, `35-39` &lt;dbl&gt;, `40-44` &lt;dbl&gt;,
## #   `45-49` &lt;dbl&gt;, `50-54` &lt;dbl&gt;, `55-59` &lt;dbl&gt;, `60-64` &lt;dbl&gt;,
## #   `65-69` &lt;dbl&gt;, `70-74` &lt;dbl&gt;, `75-79` &lt;dbl&gt;, `80-84` &lt;dbl&gt;, `85 and
## #   older` &lt;dbl&gt;, label &lt;chr&gt;, source &lt;chr&gt;, updated &lt;chr&gt;</code></pre>
<p><br></p>
<blockquote>
<p>We can see that cancer incidence data is available from years 2000 to 2014 for both sexes, 18 age groups and 73 different types of cancer sites …</p>
</blockquote>
<p><strong>Hold on…</strong> This table has data intermingled with summary data – incidence of specific cancer types are next to total incidence – , that’s bad!</p>
<pre><code>Year  Site                              Sex
&lt;fctr&gt;&lt;fctr&gt;                            &lt;fctr&gt;
2000    All malignant neoplasms (C00-C97)   Men     &lt;- tallies
2000    All malignant neoplasms (C00-C97)   Women     &lt;- tallies
2000    All malignant neoplasms except skin (other) (C00-C97, except C44)   Men &lt;- tallies
2000    All malignant neoplasms except skin (other) (C00-C97, except C44)   Women   &lt;- tallies
2000    Lip, oral cavity and pharynx (C00-C14)  Men &lt;- tallies
2000    Lip, oral cavity and pharynx (C00-C14)  Women   &lt;- tallies
2000    ..Lip (C00) Men 
2000    ..Lip (C00) Women   
2000    ..Tongue (C01-02)   Men 
2000    ..Tongue (C01-02)</code></pre>
<p>Summaries are provided for different range of <strong>ICD10</strong> codes e.g. “(C00-C97)” covers all types of cancer. We probably want to extract ICD10 codes to <strong>identify and label summary data</strong> so that we can decide later what we do with these rows.</p>
<p>Additionally, <strong>we have three metadata columns</strong> in dataset called “label”, “source” and “updated”.</p>
<ul>
<li>Variable “label” says what the values are,</li>
<li>“source” gives us info about data origin and</li>
<li>“updated” is the date of the last update.</li>
</ul>
<p>Because these three seem to be constants in our table, we want to place them into separate objects for later use in plot annotation.</p>
<pre class="r"><code>## keep label and source in a separate variables
label &lt;- unique(incidence$label)
data_source &lt;- unique(incidence$source)
updated &lt;- unique(incidence$updated)</code></pre>
<p>Table metadata shows that values are <strong>age-specific incidence rate of malignant neoplasms per 100 000 inhabitants</strong> and originate from <strong>Estonian Cancer Registry</strong> and were last time updated in <strong>2015-06-18</strong>.</p>
<p><strong>Extract ICD10 codes</strong>. We use <code>extract_icd()</code> helper function from “boulder” package to extract ICD10 codes from Site variable.</p>
<pre class="r"><code>## Extract ICD10 codes and keep them in a separate dataframe
icd10 &lt;- mutate(incidence, 
                icd10 = map(Site, extract_icd)) %&gt;% 
  select(Site, icd10)
## Let&#39;s have a look, for reviewing the result we filter only short strings, note that icd10 is list column (list of character vectors)
icd10 %&gt;% filter(str_length(Site) &lt; 30)</code></pre>
<pre><code>## # A tibble: 1,110 x 2
##                          Site      icd10
##                         &lt;chr&gt;     &lt;list&gt;
##  1                ..Lip (C00)  &lt;chr [1]&gt;
##  2                ..Lip (C00)  &lt;chr [1]&gt;
##  3          ..Tongue (C01-02)  &lt;chr [2]&gt;
##  4          ..Tongue (C01-02)  &lt;chr [2]&gt;
##  5        ..Nasopharynx (C11)  &lt;chr [1]&gt;
##  6        ..Nasopharynx (C11)  &lt;chr [1]&gt;
##  7 Digestive organs (C15-C26) &lt;chr [12]&gt;
##  8 Digestive organs (C15-C26) &lt;chr [12]&gt;
##  9         ..Oesophagus (C15)  &lt;chr [1]&gt;
## 10         ..Oesophagus (C15)  &lt;chr [1]&gt;
## # ... with 1,100 more rows</code></pre>
<p>While we are on this, we also want to trim those offending dots from beginning of names. We use <code>stri_trim_left()</code> from “stringi” to trim all characters from the beginning of strings <strong>until first alphabetic character</strong> (<code>?regex</code>). To exclude table metadata constants, we use <code>select()</code> from “dplyr”.</p>
<pre class="r"><code>## trim characters until first [[:alpha:]], we keep also original Site values in Site_old and remove constant columns from table
incidence &lt;- mutate(incidence, 
                    Site_old = Site,
                    Site = stri_trim_left(Site, &quot;[[:alpha:]]&quot;)) %&gt;% 
  select(-label, -source, -updated)
## for reviewing the result we filter only short strings
incidence %&gt;% 
  select(Site_old, Site) %&gt;% 
  filter(str_length(Site_old) &lt; 20)</code></pre>
<pre><code>## # A tibble: 660 x 2
##               Site_old              Site
##                  &lt;chr&gt;             &lt;chr&gt;
##  1         ..Lip (C00)         Lip (C00)
##  2         ..Lip (C00)         Lip (C00)
##  3   ..Tongue (C01-02)   Tongue (C01-02)
##  4   ..Tongue (C01-02)   Tongue (C01-02)
##  5 ..Nasopharynx (C11) Nasopharynx (C11)
##  6 ..Nasopharynx (C11) Nasopharynx (C11)
##  7  ..Oesophagus (C15)  Oesophagus (C15)
##  8  ..Oesophagus (C15)  Oesophagus (C15)
##  9     ..Stomach (C16)     Stomach (C16)
## 10     ..Stomach (C16)     Stomach (C16)
## # ... with 650 more rows</code></pre>
<blockquote>
<p>Table is in the wide format, we want to convert it into long/tidy format and filter out missing data.</p>
</blockquote>
<p><strong>Reshape data</strong>. Values are in the age group columns. We try to reshape table such as the age groups go into “age” column and values will be in the column called “incidence”. We use <code>gather()</code> from “tidyr” library to bring age group values into one column and incidence values into the other. Here we also need to supply the names of the value columns, otherwise <code>gather()</code> will put all categorical variables into the key column and all numeric values into value column.</p>
<pre class="r"><code>## Let&#39;s look what happens when we run gather on our data
gather(incidence)</code></pre>
<pre><code>## # A tibble: 48,180 x 2
##      key value
##    &lt;chr&gt; &lt;chr&gt;
##  1  Year  2000
##  2  Year  2000
##  3  Year  2000
##  4  Year  2000
##  5  Year  2000
##  6  Year  2000
##  7  Year  2000
##  8  Year  2000
##  9  Year  2000
## 10  Year  2000
## # ... with 48,170 more rows</code></pre>
<p>Not what we want!</p>
<blockquote>
<p>It might not be always clear what <code>gather()</code> result will look like, you might need several iterations to get expected result.</p>
</blockquote>
<p><strong>Select columns cleverly</strong>. Incidence data is in the age groups columns are labelled from <code>0-4</code> to <code>85 and older</code>, we need to supply the names of these columns to <code>gather()</code>.</p>
<p>We can do this by supplying the names of all 18 age group columns to function (risking with typos and we need to backquote these names because of dash characters) or we can <strong>do this in the smart way</strong>.</p>
<p>“dplyr” has <strong>select helper functions</strong> <code>?select_helpers</code> to select columns based on patterns in their names.</p>
<p>One such function is <code>matches()</code>: matches a regular expression (<code>?regex</code>). Here we need to match columns with numbers in their names. Regular expression matching zero or more numbers is <code>&quot;[[:digit:]]+&quot;</code>.</p>
<pre class="r"><code>colnames(incidence)</code></pre>
<pre><code>##  [1] &quot;Year&quot;         &quot;Site&quot;         &quot;Sex&quot;          &quot;0-4&quot;         
##  [5] &quot;5-9&quot;          &quot;10-14&quot;        &quot;15-19&quot;        &quot;20-24&quot;       
##  [9] &quot;25-29&quot;        &quot;30-34&quot;        &quot;35-39&quot;        &quot;40-44&quot;       
## [13] &quot;45-49&quot;        &quot;50-54&quot;        &quot;55-59&quot;        &quot;60-64&quot;       
## [17] &quot;65-69&quot;        &quot;70-74&quot;        &quot;75-79&quot;        &quot;80-84&quot;       
## [21] &quot;85 and older&quot; &quot;Site_old&quot;</code></pre>
<pre class="r"><code>colnames(incidence) %&gt;% matches(&quot;[[:digit:]]+&quot;, vars = .)</code></pre>
<pre><code>##  [1]  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21</code></pre>
<p>Here we use <code>gather()</code> to collect age group columns selected by <code>matches(&quot;[[:digit:]]+&quot;)</code> into columns “age” and “incidence”.</p>
<pre class="r"><code>## Values are in the age group columns
incidence_long &lt;- gather(data = incidence, 
                         key = &quot;age&quot;, 
                         value = &quot;incidence&quot;, 
                         matches(&quot;[[:digit:]]+&quot;))</code></pre>
<p>Now we have each value on separate row and can filter out missing values. Currently missing values are expicitly labeled with NA-s. Function <code>complete.cases()</code> gives logical vector indicating rows with no missing values (no NA-s). Based on this logical vector, <code>filter()</code> then keeps only <code>TRUE</code> rows.</p>
<pre class="r"><code>## Filter out missing data,
incidence_long &lt;- incidence_long %&gt;% 
  filter(complete.cases(.))
## above is same as:
## filter(incidence_long, complete.cases(incidence_long))</code></pre>
<p>Before filtering missing values table had 39420 rows and after 39420. <strong>Wow, looks that we don’t have NA-s in our table!</strong></p>
</div>
<div id="references" class="section level2 unnumbered">
<h2>References</h2>
<div id="refs" class="references">
<div id="ref-wickham2017r">
<p>Wickham, Hadley, and Garrett Grolemund. 2017. “R for Data Science.” O’Reilly Media. http://r4ds.had.co.nz.</p>
</div>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
